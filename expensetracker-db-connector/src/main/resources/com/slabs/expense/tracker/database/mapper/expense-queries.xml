<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.slabs.expense.tracker.common.database.mapper.ExpenseDAO">



	<insert id="insertExpense" parameterType="java.util.List">
		insert into EXPENSETRACKER.EXPENSE(ITEMNAME,CATEGORY,EXPTYPE,QTY,PRICE,EXPDATE,USERNAME,PRICEPERUNIT) values
		<foreach collection="list" item="record" index="index" open="(" separator="),(" close=")">
			#{record.itemName},
			#{record.category},
			#{record.exptype},
			#{record.qty},
			#{record.price},
			#{record.expdate},
			#{record.username},
			#{record.pricePerUnit}
		</foreach>
	</insert>

	<update id="updateExpense">
		update EXPENSETRACKER.EXPENSE
		<set>
			<if test="param1.itemName != null">
				itemName = #{param1.itemName},
			</if>
			<if test="param1.category != null">
				category=#{param1.category},
			</if>
			<if test="param1.exptype != null">
				exptype=#{param1.exptype},
			</if>
			<if test="param1.expdate != null">
				expdate=#{param1.expdate},
			</if>
			<if test="param1.price != null">
				price=#{param1.price},
			</if>
			<if test="param1.qty != null">
				qty=#{param1.qty},
			</if>
			<if test="param1.pricePerUnit != null">
				pricePerUnit=#{param1.pricePerUnit}
			</if>
		</set>
		where id=#{param1.id}
	</update>

	<select id="getExpense" resultType="com.slabs.expense.tracker.common.database.entity.Expense">
		select * from EXPENSETRACKER.EXPENSE where
		username=#{param1}
		<if test="param2 != null">
			and YEAR(expdate)=#{param2}
		</if>
		<if test="param3 != null">
			and MONTH(expdate) = #{param3}
		</if>
	</select>

	<select id="getTopExpense" resultType="com.slabs.expense.tracker.common.database.entity.Expense">
		select * from EXPENSETRACKER.EXPENSE where price in (
		select max(price) from expense where username=#{param1}
		and YEAR(expdate) = #{param2}
		<if test="param3 != null">
			and MONTH(expdate) = #{param3}
		</if>
		group by category)
		and username=#{param1}
		and YEAR(expdate)=#{param2}
		<if test="param3 != null">
			and MONTH(expdate) = #{param3}
		</if>
	</select>

	<select id="getTotalExpense" resultType="java.lang.Double">
		select sum(price) from EXPENSETRACKER.EXPENSE where
		username=#{param1}
		<if test="param2 != null">
			and YEAR(expdate)=#{param2}
		</if>
		<if test="param3 != null">
			and MONTH(expdate) = #{param3}
		</if>
	</select>

	<select id="getMonthWiseTotalExpense" resultType="com.slabs.expense.tracker.common.database.entity.Graph">
		select month(expdate) as MONTH, sum(price) as EXPENSE from EXPENSE where
		username =
		#{param1} and
		year(expdate) = #{param2}
		group by month(expdate)
	</select>

	<select id="getCategoryWiseTotalExpense" resultType="com.slabs.expense.tracker.common.database.entity.Graph">
		select category, sum(price) as EXPENSE from EXPENSE
		where username=#{param1} and year(expdate) = #{param2}
		<if test="param3 != null">
			and MONTH(expdate) = #{param3}
		</if>
		group by category
	</select>


	<select id="getExpenseById" resultType="com.slabs.expense.tracker.common.database.entity.Expense">
		select * from EXPENSETRACKER.EXPENSE where
		id=#{param1}
	</select>

	<select id="selectExpenseNames" resultType="com.slabs.expense.tracker.common.database.entity.Dictionary">
		select distinct itemname from EXPENSETRACKER.EXPENSE
	</select>

	<delete id="deleteExpense">
		delete from EXPENSETRACKER.EXPENSE
		where id=#{param1.id}
	</delete>

	<insert id="insertExpenseCategory" parameterType="java.util.List">
		insert into EXPENSETRACKER.EXPENSE_CATEGORY(CATEGORY,DESCRIPTION,USERNAME) values
		<foreach collection="list" item="record" index="index" open="(" separator="),(" close=")">
			#{record.category},
			#{record.description},
			#{record.username}
		</foreach>
	</insert>

	<update id="updateExpenseCategory" parameterType="com.slabs.expense.tracker.common.database.entity.ExpenseCategory">

		update EXPENSETRACKER.EXPENSE_CATEGORY
		<set>
			<if test="param1.category != null">
				category=#{param1.category},
			</if>
			<if test="param1.description != null">
				description=#{param1.description}
			</if>
		</set>
		where categoryId=#{param1.categoryId}

	</update>

	<select id="retrieveExpenseCategory" resultType="com.slabs.expense.tracker.common.database.entity.ExpenseCategory">
		select * from EXPENSETRACKER.EXPENSE_CATEGORY where username=#{param1}
	</select>

	<delete id="deleteExpenseCategory">
		delete from EXPENSETRACKER.EXPENSE_CATEGORY
		<if test="record.categoryId != null">
			where categoryId=#{param1.categoryId}
		</if>
	</delete>

	<select id="getExpenseTypes" resultType="com.slabs.expense.tracker.common.database.entity.ExpenseType">
		select * from EXPENSETRACKER.EXPENSETYPE
	</select>

	<insert id="insertExpenseType" parameterType="java.util.List">
		insert into EXPENSETRACKER.EXPENSETYPE(EXPTYPE, DESCRIPTION) values
		<foreach collection="list" item="record" index="index" open="(" separator="),(" close=")">
			#{record.exptype},
			#{record.description}
		</foreach>
	</insert>

	<update id="updateExpenseType" parameterType="com.slabs.expense.tracker.common.database.entity.ExpenseType">
		update EXPENSETRACKER.EXPENSETYPE
		<set>
			<if test="param1.exptype != null">
				exptype=#{param1.exptype},
			</if>
			<if test="param1.description != null">
				description=#{param1.description}
			</if>
		</set>
	</update>

	<delete id="deleteExpenseType" parameterType="int">
		delete from EXPENSETRACKER.EXPENSETYPE where id=#{param1}
	</delete>

</mapper>