<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.slabs.expense.tracker.common.database.mapper.UserDAO">

	<resultMap type="com.slabs.expense.tracker.common.database.entity.UserInfo" id="UserInfo">
		<result column="FIRSTNAME" property="firstName" />
		<result column="LASTNAME" property="lastName" />
		<result column="SEX" property="sex" />
		<result column="USERNAME" property="username" />
		<result column="PASSWORD" property="password" />
		<result column="EMAIl" property="email" />
		<result column="MOBILE" property="mobile" />
		<result column="ADDRESS" property="address" />
		<result column="PROFILEPIC" property="profilePic" typeHandler="org.apache.ibatis.type.ClobTypeHandler" />
		<result column="ISADMIN" property="isAdmin" />
		<result column="ISFTLOGIN" property="isFtLogin" />
		<result column="ISLOCKED" property="isLocked" />
		<result column="ISVERIFIED" property="isVerified" />
		<result column="ACTIVATIONKEY" property="activationKey" />
	</resultMap>
	
	<insert id="createUser" parameterType="com.slabs.expense.tracker.common.database.entity.UserInfo">
		insert into EXPENSETRACKER.USERINFO(FIRSTNAME, LASTNAME, SEX, USERNAME,PASSWORD,EMAIL,MOBILE,ADDRESS)
		values(
		#{param1.firstName},
		#{param1.lastName},
		#{param1.sex},
		#{param1.username},
		#{param1.password},
		#{param1.email},
		#{param1.mobile},
		#{param1.address}
		)
	</insert>

	<update id="updateUser">
		update EXPENSETRACKER.USERINFO
		<set>
			<if test="param1.firstName != null">
				firstName=#{param1.firstName},
			</if>
			<if test="param1.lastName != null">
				lastName=#{param1.lastName},
			</if>
			<if test="param1.sex != null">
				sex=#{param1.sex},
			</if>
			<if test="param1.newPassword != null">
				password=#{param1.newPassword},
			</if>
			<if test="param1.email != null">
				email=#{param1.email},
			</if>
			<if test="param1.mobile != null">
				mobile=#{param1.mobile},
			</if>
			<if test="param1.address != null">
				address=#{param1.address},
			</if>
			<if test="param1.profilePic != null">
				profilePic=#{param1.profilePic, typeHandler=org.apache.ibatis.type.ClobTypeHandler},
			</if>
			<if test="param1.isAdmin != null">
				isAdmin=#{param1.isAdmin}
			</if>
			<if test="param1.isFtLogin != null">
				isFtLogin=#{param1.isFtLogin}
			</if>
			<if test="param1.isVerified != null">
				isVerified=#{param1.isVerified}
			</if>
			<if test="param1.isLocked != null">
				isLocked=#{param1.isLocked}
			</if>
			<if test="param1.activationKey != null">
				activationKey=#{param1.activationKey}
			</if>
		</set>
		where username=#{param1.username}
	</update>

	<update id="activateUser">
		update EXPENSETRACKER.USERINFO set isVerified=#{param2} where username=#{param1}
	</update>

	<select id="getUser" resultMap="UserInfo">
		select FIRSTNAME, LASTNAME, SEX, USERNAME, EMAIL, MOBILE, ADDRESS, PROFILEPIC, ISADMIN, ISFTLOGIN, ISVERIFIED, ISLOCKED, ACTIVATIONKEY
		<if test="param2">
			,PASSWORD
		</if>
		from EXPENSETRACKER.USERINFO
		<if test="param1 != null">
			where USERNAME=#{param1}
		</if>
	</select>

	<delete id="deleteUser">
		delete from EXPENSETRACKER.USERINFO where username=#{param1.username}
	</delete>

	<update id="setActivationKey">
		update EXPENSETRACKER.USERINFO set activationKey=#{param2} where username=#{param1}
	</update>
	
</mapper>