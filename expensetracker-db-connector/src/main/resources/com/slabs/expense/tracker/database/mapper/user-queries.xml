<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.slabs.expense.tracker.database.mapper.UserDAO">

	<resultMap type="com.slabs.expense.tracker.common.db.entity.UserInfo" id="UserInfo">
		<result column="FIRSTNAME" property="firstName" />
		<result column="LASTNAME" property="lastName" />
		<result column="SEX" property="sex" />
		<result column="USERNAME" property="username" />
		<result column="PASSWORD" property="password" />
		<result column="EMAIl" property="email" />
		<result column="MOBILE" property="mobile" />
		<result column="ADDRESS" property="address" />
		<result column="PROFILEPIC" property="profilePic" typeHandler="org.apache.ibatis.type.ClobTypeHandler" />
		<result column="ISADMIN" property="isAdmin" />
		<result column="ISFTLOGIN" property="isFtLogin" />
		<result column="ISLOCKED" property="isLocked" />
		<result column="ISVERIFIED" property="isVerified" />
		<result column="ACTIVATIONKEY" property="activationKey" />
	</resultMap>

	<resultMap type="com.slabs.expense.tracker.common.db.entity.Message" id="Message">
		<result column="ID" property="id" />
		<result column="MSGFROM" property="msgfrom" />
		<result column="SUBJECT" property="subject" />
		<result column="MESSAGE" property="message" typeHandler="org.apache.ibatis.type.ClobTypeHandler" />
		<result column="ISNEW" property="isNew" />
	</resultMap>

	<resultMap type="com.slabs.expense.tracker.common.db.entity.Message" id="Query">
		<result column="ID" property="id" />
		<result column="MSGFROM" property="msgfrom" />
		<result column="SUBJECT" property="subject" />
		<result column="EMAIL" property="email" />
		<result column="MESSAGE" property="message" typeHandler="org.apache.ibatis.type.ClobTypeHandler" />
		<result column="ISNEW" property="isNew" />
	</resultMap>

	<insert id="createUser" parameterType="com.slabs.expense.tracker.common.db.entity.UserInfo">
		insert into EXPENSETRACKER.USERINFO(FIRSTNAME, LASTNAME, SEX, USERNAME,PASSWORD,EMAIL,MOBILE,ADDRESS)
		values(
		#{record.firstName},
		#{record.lastName},
		#{record.sex},
		#{record.username},
		#{record.password},
		#{record.email},
		#{record.mobile},
		#{record.address}
		)
	</insert>

	<update id="updateUser">
		update EXPENSETRACKER.USERINFO
		<set>
			<if test="record.firstName != null">
				firstName=#{record.firstName},
			</if>
			<if test="record.lastName != null">
				lastName=#{record.lastName},
			</if>
			<if test="record.sex != null">
				sex=#{record.sex},
			</if>
			<if test="record.newPassword != null">
				password=#{record.newPassword},
			</if>
			<if test="record.email != null">
				email=#{record.email},
			</if>
			<if test="record.mobile != null">
				mobile=#{record.mobile},
			</if>
			<if test="record.address != null">
				address=#{record.address},
			</if>
			<if test="record.profilePic != null">
				profilePic=#{record.profilePic, typeHandler=org.apache.ibatis.type.ClobTypeHandler},
			</if>
			<if test="record.isAdmin != null">
				isAdmin=#{record.isAdmin}
			</if>
			<if test="record.isFtLogin != null">
				isFtLogin=#{record.isFtLogin}
			</if>
			<if test="record.isVerified != null">
				isVerified=#{record.isVerified}
			</if>
			<if test="record.isLocked != null">
				isLocked=#{record.isLocked}
			</if>
			<if test="record.activationKey != null">
				activationKey=#{record.activationKey}
			</if>
		</set>
		where username=#{record.username}
	</update>

	<update id="activateUser">
		update EXPENSETRACKER.USERINFO set isVerified=#{isActivate} where username=#{username}
	</update>

	<select id="getUser" resultMap="UserInfo">
		select FIRSTNAME, LASTNAME, SEX, USERNAME, EMAIL, MOBILE, ADDRESS, PROFILEPIC, ISADMIN, ISFTLOGIN, ISVERIFIED, ISLOCKED, ACTIVATIONKEY
		<if test="includePassword">
			,PASSWORD
		</if>
		from EXPENSETRACKER.USERINFO
		<if test="username != null">
			where USERNAME=#{username}
		</if>
	</select>

	<delete id="deleteUser">
		delete from EXPENSETRACKER.USERINFO where username=#{record.username}
	</delete>

	<update id="setActivationKey">
		update EXPENSETRACKER.USERINFO set activationKey=#{activationKey} where username=#{username}
	</update>

	<insert id="insertMessage" parameterType="java.util.List">
		insert into EXPENSETRACKER.MESSAGE(MSGFROM, SUBJECT, MESSAGE, ISNEW) values
		<foreach collection="records" item="record" index="index" open="(" separator="),(" close=")">
			#{record.msgfrom},
			#{record.subject},
			#{record.message,
			typeHandler=org.apache.ibatis.type.ClobTypeHandler},
			#{record.isNew}
		</foreach>
	</insert>

	<update id="updateMessage" parameterType="com.slabs.expense.tracker.common.db.entity.Message">
		update EXPENSETRACKER.MESSAGE
		<set>
			<if test="record.subject != null">
				subject=#{record.subject},
			</if>
			<if test="record.message != null">
				message=#{record.message},
			</if>
			<if test="record.isNew != null">
				isnew=#{record.isNew},
			</if>
		</set>
		where msgfrom=#{record.msgfrom}
	</update>

	<delete id="deleteMessage">
		delete from EXPENSETRACKER.MESSAGE
		where id=#{record.id}
	</delete>

	<select id="getMessage" resultMap="Message">
		select * from EXPENSETRACKER.MESSAGE where username=#{username}
		<if test="isNew">
			and isNew=#{isNew}
		</if>
	</select>

	<insert id="insertQuery">
		insert into EXPENSETRACKER.QUERY(MSGFROM, SUBJECT,EMAIL, MESSAGE, ISNEW) values (		
			#{record.msgfrom},
			#{record.subject},
			#{record.email},
			#{record.message,
			typeHandler=org.apache.ibatis.type.ClobTypeHandler},
			#{record.isNew}
			)		
	</insert>

	<update id="updateQuery" parameterType="com.slabs.expense.tracker.common.db.entity.Message">
		update EXPENSETRACKER.MESSAGE
		<set>
			<if test="record.isNew != null">
				isnew=#{record.isNew},
			</if>
		</set>
	</update>

	<delete id="deleteQuery">
		delete from EXPENSETRACKER.MESSAGE
		where id=#{record.id}
	</delete>

	<select id="getQuery" resultMap="Query">
		select * from EXPENSETRACKER.QUERY
		<if test="isNew">
			where isNew=#{isNew}
		</if>
	</select>


</mapper>